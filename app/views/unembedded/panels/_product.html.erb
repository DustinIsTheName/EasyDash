<%= form_for @resource, url: url_for(controller: 'unembedded', action: 'update_api'), method: :put do |o| %>

  <input type="hidden" name="resource" value="<%= @type %>"> 
  <input type="hidden" name="id" value="<%= @resource.id %>"> 
  <article>
    <div class="card">
      <div class="row">
        <label>Title</label>
        <%= o.text_field :title, placeholder: "Short Sleeve T-Shirt" %>
      </div>
      <div class="row no_margin">
        <label>Description</label>
        <%= o.text_area :body_html %>
      </div>
    </div>
  </article>
  <article>
    <!-- <a href="#" class="theme-editor-action-list__item" data-bind-event-click="action("openSectionPanel", "section-images")" draggable="false"> -->
      <div class="card drop_images">
        <!-- <h5 class="wittyEDPanelButton">Images</h5>
        <button class="btn btn--plain icon-next dark tip" type="button" name="button" data-hover="Edit/add/delete images"></button> -->
        <h5>Images</h5>
        <div class="row no_margin">
          <a style="display: inherit; margin-bottom: 1rem;" href="">Add images from URL</a>
          <a href="">Add images</a>
          <div class="column twelve type--centered no_margin">
            <i class="image icon-photos next-icon--size-80"></i>
            <h5>Drop images to upload</h5>
          </div>
        </div>
      </div>
    <!-- </a> -->
  </article>

  <% if @resource.variants.first.title == 'Default Title' %>

    <%= fields_for 'variants[]', @resource.variants.first do |v| %>

      <article>
        <div class="card">
          <h5>Pricing</h5>
          <div class="row">
            <label>Price</label>
            <div class="next-input--stylized next-input--has-content">
              <span class="next-input__add-on next-input__add-on--before">$</span>
              <%= v.text_field :price, placeholder: "0.00", class: "next-input next-input--invisible" %>
            </div>
          </div>
          <div class="row next-input-stylized">
            <label>Compare at price</label>
            <div class="next-input--stylized next-input--has-content">
              <span class="next-input__add-on next-input__add-on--before">$</span>
              <%= v.text_field :compare_at_price, class: "next-input next-input--invisible" %>
            </div>
          </div>
          <div class="row no_margin">
            <label>
              <%= v.check_box :taxable %>
              Charge taxes on this product
            </label>
          </div>
        </div>
      </article>
      <article>
        <div class="card">
          <h5>Inventory</h5>
          <div class="row">
            <label>SKU (Stock Keeping Unit)</label>
            <%= v.text_field :sku %>
          </div>
          <div class="row">
            <label>Barcode (ISBN, UPC, GTIN, etc.)</label>
            <%= v.text_field :barcode %>
          </div>
          <div class="row no_margin">
            <label>Inventory policy</label>
            <%= v.select :inventory_management, inventory_management_options %>
          </div>
        </div>
      </article>
      <article>
        <div class="card">
          <h5>Shipping</h5>
          <div class="row">
            <label>
              <%= v.check_box :requires_shipping %>
              This product requires shipping
            </label>
          </div>
          <div class="divider"></div>
          <div class="row extra_margin">
            <h6>Weight</h6>
            <p class="subdued">Used to calculate shipping rates at checkout and label prices during fulfillment.</p>
            <label>Weight</label>
            <div class="input-group">
              <%= v.text_field :weight, class: 'sidebyside_75' %>
              <%= v.select :weight_unit, weight_unit_options, {}, {class: 'secondary sidebyside_25'} %>
            </div>
          </div>

          <div class="row">
            <h6>International Customs</h6>
            <label>HS tariff code <a href="http://hts.usitc.gov/" target="_blank">(look up code)</a></label>
            <% if v.object.metafields.count > 0 %>
              <% v.object.metafields.each do |metafield| %>
                <% if metafield.key == 'harmonized_system_code' %>
                  <%= fields_for 'variants['+v.object.id.to_s+']metafields[]', metafield do |m| %>
                    <%= m.text_field :value %>
                  <% end %>
                <% end %>
              <% end %>
            <% else %>
              <%= fields_for 'variants['+v.object.id.to_s+']new_metafields[]', ShopifyAPI::Metafield.new do |m| %>
                <%= m.hidden_field :name, value: "harmonized_system_code" %>
                <%= m.text_field :value, class: "new_field" %>
              <% end %>
            <% end %>
          </div>
          <div class="divider"></div>
          <div class="row no_margin">
            <h6>Fulfillment Service</h6>
            <%= v.select :fulfillment_service, fulfillment_service_options(@fulfillment_services) %>
          </div>
        </div>
      </article>

    <% end %>

    <article>
      <div class="card">
        <h5>Variants</h5>
        <p>Add variants if this product comes in multiple versions, like different sizes or colors.</p>
        <button class="secondary reveal-trigger" data-reveal="options">Add variant</button>
        <div class="accordion_grey bottom rounded_bottom reveal-target" data-reveal="options">
          <div class="row">
            <label>Option name</label>
            <input name="new_option_1" class="extra_margin" type="text" value="Size"/>
            <label>Option values</label>
            <input name="new_option_values_1" type="text" placeholder="Separate options with a comma"/>
          </div>
          <div class="divider" style="margin-left: 0; margin-right: 0;"></div>
          <button class="secondary reveal-trigger" data-reveal="options_2">Add another option</button>

          <div class="reveal-target" data-reveal="options_2">
            <div class="row">
              <label>Option name</label>
              <input name="new_option_2" class="extra_margin" type="text" value="Color"/>
              <label>Option values</label>
              <input name="new_option_values_2" type="text" placeholder="Separate options with a comma"/>
            </div>
            <div class="divider" style="margin-left: 0; margin-right: 0;"></div>
            <button class="secondary reveal-trigger" data-reveal="options_3">Add another option</button>
          </div>

          <div class="reveal-target" data-reveal="options_3">
            <div class="row">
              <label>Option name</label>
              <input name="new_option_3" class="extra_margin" type="text" value="Material"/>
              <label>Option values</label>
              <input name="new_option_values_3" type="text" placeholder="Separate options with a comma"/>
            </div>
          </div>
        </div>
      </div>
    </article>

  <% else %>

    <article>
      <div class="card">
        <div class="row">
          <a style="display: inherit; margin-bottom: 1rem;" href="">Redorder variants</a>
          <a style="display: inherit; margin-bottom: 1rem;" href="">Edit options</a>              
          <a style="display: inherit; margin-bottom: 1rem;" href="">Add variant</a>
          <div class="divider"></div>
          <div class="variant-selector">
            <ul class="variant-selector-list">
              <li class="variant-selector-item">Select:</li>
              <li class="variant-selector-item variant-selector-link" data-option="all">
                All
              </li>
              <li class="variant-selector-item variant-selector-link" data-option="none">
                None
              </li>
              <% @resource.options.each_with_index do |option, index| %>
                <% option.values.each do |value| %>
                  <li class="variant-selector-item option-<%= index + 1 %> variant-selector-link" data-option="<%= index + 1 %>" data-value="<%= value %>">
                    <%= value %>
                  </li>
                <% end %>
              <% end %>
            </ul>
          </div>
        </div><!-- .row -->
        <div class="row no_margin">
          <div class="bulk_checkbox extra_margin">
            <input type="checkbox">
            <%= svgs 'arrow_down' %>
          </div>
          <% @resource.variants.each do |variant| %>
            <%= fields_for 'variants[]', variant do |v| %>
              <div class="variant" data-option1="<%= variant.option1 %>" data-option2="<%= variant.option2 %>" data-option3="<%= variant.option3 %>" >
                <div class="col_left">
                  <input type="checkbox">
                  <% if variant.image_id %>
                    <div class="variant_image">
                      <img src="<%= @resource.images.select{ |i| i.id == variant.image_id }.first.src %>">
                    </div>
                  <% else %>
                    <div class="variant_image">
                      <i class="icon-image"></i>
                    </div>
                  <% end %>
                </div>
                <div class="col_right">
                  <ul class="variant_options lists">
                    <li class="option-1"><%= variant.option1 %></li>
                    <li class="option-2"><%= variant.option2 %></li>
                    <li class="option-3"><%= variant.option3 %></li>
                  </ul>
                  <ul class="variant_options inputs">
                    <% for i in 1..3 %>
                      <% if variant.attributes["option#{i}"] %>
                        <li class="option-<%= i %>">
                          <span class="label"><%= @resource.options[i - 1].name %></span>
                          <%= v.text_field "option#{i}".to_sym %>
                        </li>
                      <% else %>
                        <li class="option-<%= i %> null">
                          <span class="label">Option <%= i %></span>
                          <div class="skeleton_option"></div>
                        </li>
                      <% end %>
                    <% end %>
                  </ul>
                </div>
                <div class="inputs_container">
                  <div class="input">
                    <label>Inventory</label>
                    <% if variant.inventory_management %>
                      <%= v.text_field :inventory_quantity %>
                    <% else %>
                      <input type="text" class="null" value="N/A" readonly>
                    <% end %>
                  </div>
                  <div class="input">
                    <label>Compare at Price</label>
                    <%= v.text_field :compare_at_price %>
                  </div>
                  <div class="input">
                    <label>Price</label>
                    <%= v.text_field :price %>
                  </div>
                  <div class="input">
                    <label>SKU</label>
                    <%= v.text_field :sku %>
                  </div>
                </div>
                <div class="buttons">
                  <button class="sidebyside_85 primary">Edit variant</button>
                  <button class="sidebyside_15 warning icon-trash tip" data-hover="Delete Variant"></button>
                </div>
              </div>
            <% end %>
          <% end %>
        </div><!-- .row -->
      </div><!-- .card -->
    </article>

  <% end %>

  <article>
    <div class="theme-editor-action-list__item" data-bind-event-click="action("openSectionPanel", "section-seo")" draggable="false">
      <div class="card">
        <h5>Search engine listing preview</h5>
        <p>Add a description to see how this product might appear in a search engine listing.</p>
        <button class="secondary reveal-trigger" data-reveal="seo">Edit website SEO</button>
        <div class="edit reveal-target" data-reveal="seo">

          <% title_tag_index = false %>
          <% description_tag_index = false %>

          <% @resource.metafields.each_with_index do |metafield, index| %>
            <% if metafield.key == 'title_tag' %>
              <% title_tag_index = index %>
            <% end %>
            <% if metafield.key == 'description_tag' %>
              <%= fields_for 'metafields[]', metafield do |m| %>
                <% description_tag_index = index %>
              <% end %>
            <% end %>
          <% end %>

          <div class="row">
            <% if title_tag_index %>
              <%= fields_for 'metafields[]', @resource.metafields[title_tag_index] do |m| %>
                <%= m.text_field :value %>
              <% end %>
            <% else %>
              <%= fields_for 'new_metafields[]', ShopifyAPI::Metafield.new do |m| %>
                <%= m.hidden_field :name, value: 'title_tag', class: "new_field" %>
                <%= m.text_field :value, class: "new_field" %>
              <% end %>
            <% end %>
          </div>

          <div class="row">
            <% if description_tag_index %>
              <%= fields_for 'metafields[]',  @resource.metafields[description_tag_index] do |m| %>
                <%= m.text_area :value %>
              <% end %>
            <% else %>
              <%= fields_for 'new_metafields[]', ShopifyAPI::Metafield.new do |m| %>
                <%= m.hidden_field :name, value: 'description_tag', class: "new_field" %>
                <%= m.text_area :value, class: "new_field" %>
              <% end %>
            <% end %>
          </div>

          <div class="row no_margin">
            <%= o.text_field :handle %>
          </div>
        </div>
        <!-- <button class="btn btn--plain icon-next dark" type="button" name="button"></button> -->
      </div>
    </div>
  </article>
  <article>
    <div class="card secondary">
      <h5>Visibility</h5>
      <div class="divider"></div>
      <div class="row no_margin">
        <label>
          <% if @resource.published_at %>
            <input type="checkbox" name="shopify_api_product[published_at]" checked="checked">
            <input type="hidden" name="shopify_api_product[old_published_at]" value="true">
          <% else %>
            <input type="checkbox" name="shopify_api_product[published_at]">
          <% end %>
          Online store
          <a href="">
            <i class="icon-calendar tip" data-hover="Set publish date"></i>
          </a>
        </label>
      </div>
    </div>
  </article>
  <article>
    <div class="card secondary">
      <h5>Organization</h5>
      <div class="row extra_margin">
        <label>Product type</label>
        <div class="input-group">
          <%= o.text_field :product_type, placeholder: "Shirts" %>
          <button class="secondary icon-down"></button>
        </div>
      </div>
      <div class="row">
        <label>Vendor</label>
        <div class="input-group">
          <%= o.text_field :vendor, placeholder: "Nike" %>
          <button class="secondary icon-down"></button>
        </div>
      </div>
      <div class="divider"></div>
      <div class="row">
        <label class="extra_margin">Collection</label>
        <input type="search" placeholder="Search for collections" />
        <em>Add this product to a collection so it’s easy to find in your store.</em>
      </div>
      <div class="divider"></div>
      <div class="row no_margin">
        <label class="extra_margin">Tags <a href="#" class="label-cta">View all tags</a></label>
        <%= o.text_field :tags, placeholder: "Vintage, cotton, summer" %>
      </div>
    </div>
  </article>
  <article>
    <div class="card secondary">
      <h5>Theme templates</h5>
      <label>Template suffix</label>
      <%= o.select :template_suffix, template_suffix_options(@assets.select{|asset| asset.key.include? "templates/product" }), {}, {class: "secondary extra_margin"} %>>
      <em class="no_margin">The template customers see when viewing this product in your store.</em>
    </div>
  </article>
  <div class="wittyEDBottomButtons"> 
    <!-- <button class="secondary red btn_bottom">Delete product</button> -->
    <button class="warning btn_bottom">Delete product</button>  
  </div>

  <%= o.submit %>
<% end %>